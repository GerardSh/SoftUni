# General
Microsoft се опитват да привлекат програмистите, които традиционно работят директно с бази данни, като ги насочат към работа с колекции в .NET. Самата база данни може да се разглежда като колекция от таблици, всяка таблица – като колекция от редове, а всеки ред – като колекция от колони.

В периода, когато Microsoft популяризират своя език за програмиране, голяма част от бизнес логиката започва да се изнася към приложенията. Това се счита за предимство, тъй като извличането на данни от базата е бавен процес, а разработчиците са съсредоточени предимно върху SQL. Възползвайки се от този факт, Microsoft създават в .NET концепция, която наподобява SQL – езика за заявки LINQ (Language Integrated Query).

Когато по-късно разработват ORM, естествено възниква идеята работата с Entity Framework да бъде интегрирана с LINQ. Това води до широко използване на LINQ при работа с Entity Framework Core, тъй като той осигурява интуитивен начин за обработка на данни в стил, близък до SQL, но с възможност за по-добра интеграция в .NET приложенията.
## Asynchronous Methods
Трябва да използваме асинхронните версии на методите, когато е възможно, защото в противен случай блокираме нишката, която изпълнява заявката. Операциите в базите данни и други бавни операции, като достъп до файловата система или мрежови заявки, обикновено отнемат време за изпълнение. Това е важно, защото ако не използваме асинхронност, нишката ще бъде блокирана, докато чака резултата, което води до неефективно използване на ресурсите.

Независимо от причината за забавянето, ако дадена операция е I/O-bound и изисква време за изпълнение, тя трябва да бъде маркирана като асинхронна. Когато извършваме такива операции асинхронно, позволяваме на сървъра, докато чака резултата, да обработва други заявки. Това води до по-ефективно използване на ресурсите, като позволява на нишките в пула да обслужват повече потребители.

Докато приложението чака резултат от външен източник, какъвто е базата данни, сървърът може да продължи да обработва други заявки. Дори ако на сървъра работи само нашето приложение, асинхронността носи ползи при увеличен брой потребители, тъй като позволява по-добро управление на наличните нишки.

Ако например сървърната машина разполага с осем ядра, това означава, че физически могат да работят само осем нишки едновременно. Ако дадена нишка е блокирана, докато чака отговор от базата данни, тя не може да изпълнява друга задача, което ограничава капацитета на сървъра. Използвайки асинхронни методи, позволяваме на системата да освободи нишката, докато чака резултат, така че тя да бъде използвана за обработка на друга заявка.

Важно е да се отбележи, че шаблонът `async/await` не гарантира, че операцията ще бъде изпълнена асинхронно на ниво хардуер. Това зависи от .NET Runtime, който решава дали операцията ще бъде обработена асинхронно въз основа на натоварването на системата и естеството на самата задача. Въпреки това, използването на асинхронни методи дава възможност на системата динамично да управлява ресурсите и да подобри производителността при работа с бавни операции.

Ако не материализираме заявката, тя няма да бъде изпълнена, докато не се опитаме да я използваме. Например, ако използваме `foreach` върху резултата от заявка, това автоматично ще я материализира и ще я изпълни веднага. Това обаче означава, че губим възможността да изпълним заявката асинхронно, тъй като `foreach` блокира изпълнението, докато не се получат всички резултати. За да запазим асинхронността, трябва да използваме подходящи методи като `ToListAsync()` или `ToArrayAsync()`, които материализират заявката по асинхронен начин.
## Expression Tree
Expression Tree в .NET предоставя начин за представяне на кода като обектен модел, което позволява анализ и модифициране на заявките преди тяхното изпълнение. Това е особено полезно при работата с LINQ, където заявките могат да бъдат трансформирани динамично, преди да се превърнат в SQL или друга форма за изпълнение.

Entity Framework Core използва Expression Trees, за да обработва и оптимизира заявките, като позволява добавяне на допълнителни условия, промяна на селектираните колони или дори комбиниране на различни изрази. Това осигурява гъвкавост и възможност за динамично изграждане на заявки според нуждите на приложението.
# Misc
## EF Core Explicit Column Selection
При генерирането на заявки, EF никога не използва `SELECT *`, а винаги изрежда конкретните колони. Това се прави именно за да се избегнат грешки при промени в схемата на базата данни. Ако в таблицата бъдат добавени нови колони, но моделът в приложението не е актуализиран, използването на `SELECT *` би довело до получаване на неочаквани данни, които EF Core не знае как да обработи. Изричното изброяване на колоните гарантира, че заявките ще върнат само тези данни, които съответстват на дефинирания модел.
# ChatGPT
# Bookmarks
Completion: 24.02.2025